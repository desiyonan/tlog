<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>OAuth2 | DnF&#39;s Zone</title>
<meta name="keywords" content="web, auth, oauth2" />
<meta name="description" content="简介
记录下授权oauth2的理解，还有自己的疑问等等。">
<meta name="author" content="DnF">
<link rel="canonical" href="https://zone.dnfn.tech/2021/07/202107171742448/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.9445355f596ee58055c201d32b7c93581eac8f2ace5b4cabc73d79c100438abc.css" integrity="sha256-lEU1X1lu5YBVwgHTK3yTWB6sjyrOW0yrxz15wQBDirw=" rel="preload stylesheet" as="style">
<link rel="preload" href="https://raw.dnfn.tech/img/2021/06/Photo.jfif" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://zone.dnfn.tech/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="https://zone.dnfn.tech/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="https://zone.dnfn.tech/favicon.svg">
<link rel="apple-touch-icon" href="https://zone.dnfn.tech/apple-touch-icon.png">
<link rel="mask-icon" href="https://zone.dnfn.tech/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.83.1" />
<meta property="og:title" content="OAuth2" />
<meta property="og:description" content="简介
记录下授权oauth2的理解，还有自己的疑问等等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zone.dnfn.tech/2021/07/202107171742448/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-07-17T16:24:48&#43;08:00" />
<meta property="article:modified_time" content="2021-07-17T16:24:48&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OAuth2"/>
<meta name="twitter:description" content="简介
记录下授权oauth2的理解，还有自己的疑问等等。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://zone.dnfn.tech/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "OAuth2",
      "item": "https://zone.dnfn.tech/2021/07/202107171742448/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OAuth2",
  "name": "OAuth2",
  "description": "简介 记录下授权oauth2的理解，还有自己的疑问等等。\n",
  "keywords": [
    "web", "auth", "oauth2"
  ],
  "articleBody": "简介 记录下授权oauth2的理解，还有自己的疑问等等。\n了解授权 什么是授权 简单来说就是将自己的权限给其他人，让他可以完成相应的工作任务。\n为什么需要授权 互联网作为一个的庞大网络，其中有海量的服务提供方，而我们个人作为这些服务的使用者，通常需要对不同的服务提供相同的信息（比如身份、学历、联系方式等等），而这不就相当于自己把个人信息从一个已有的服务系统拷贝另一个新的服务系统中吗？不想自己做，嫌麻烦了也可以委托其他人来拷贝，但再此之前得找自己信得过帮手让他代替自己（你肯定不希望随便一个陌生人盗用自己得信息），为了不同服务间资源数据的安全共享，这就需要授权！\n怎么授权 注：怎么授权换言之就是授权方式，先思考有哪些授权方式，它们可能会遇到的问题和处理方式，至于它们具体实现细节这里不做过多描述。\n在了解怎么授权的之前，先思考授权这个过程涉及到了哪些角色（自己的理解，比较片面）：\n 用户：资源数据的所有方 服务提供方：需要共享资源数据给外部的服务 服务使用方：第三方服务、外部服务、接入方、调用方  授权行为：用户将自己在服务提供方的权限（部分或全部）给服务使用方，使服务使用方可进行相关权限的操作。\n最简单的授权无非是服务提供方将用户的帐号密码给第三方系统（服务使用方），但这是建立在非常信任情况下（应该没有正常人会把自家大门钥匙给一个从未见面的陌生人吧）\n共享帐号密码实现确实简单直接，但这真的没有弊端吗？\n试想自己作为服务提供方采用这种方案，将会有哪些问题？\n 要是哪天用户的密码换了，又怎么让第三方系统能继续访问资源？（同步帐号密码必然遇到更多问题！） 又或者是哪天第三方其中的一个不再可信，不能再给他权限了，如何保证在不影响用户和其他第三方系统的情况下对其限制？ 再说如果给了帐号密码，就相当于用户在操作，又怎么知道用户是否真的出于意愿来进行操作？（难以保证第三方不会滥用帐号密码） 更需要注意的是权限，比如第三方系统已知用户帐号密码，那他是否可以修改用户的密码？  以上只是想到的一部分问题，估计要解决这些问题又得牺牲为数不多的头发。\n如果站在被授权方（服务使用方）的角度，这些问题都不算事，只要你给密码，我能完成工作，那就没问题！\n但是站在授权方（服务提供方）的角度，那就不得不重视了，不仅是为了用户，也是为了本系统的安全！\n从服务提供方的角度来考虑的话，怎么授权才能避免上面的问题？\n 当然是不与第三方共享密码，或者直接由用户提供帐号密码授权 需要验证第三方服务的身份，不是任何人都可以随便接入授权服务 让用户参与到过程中（提供帐号密码、确认授权范围、确认人为操作）  所以授权是最好三方（服务提供方、服务使用方、用户）一起参与才最真实可靠，简单的说就是\n 不止校验用户是否有意愿来完成授权 还要看服务使用方是否是可信的  以共享用户帐号密码的方式为例，首先只有完全可信的第三方（服务使用方）才能共享帐号密码，但用户是否真的有意愿使用功能那就不得而知了（问题3）。\n那么如何做到这些呢？\n从OAuth2 授权码模式中可以总结出了这样的答案：\n 服务使用方在服务提供方注册自己的身份信息用于验证是否可信（client_id、client_sercet等） 通过重定向页面让用户确认授权信息（用户信息通过用户登录或者已登录的会话获得，从而关联用户信息和服务使用方）  前面说到直接与多个外部系统共享用户帐号密码的方式将面临的问题，正好可以基于以上两点来解决：\n 用户更改密码，并不影响第三方系统（被授权方）在服务提供方已注册的身份信息，两者是独立的 各第三方系统（被授权方）在服务提供方注册的信息也是相互独立的，限制其中一个并不影响其他第三方系统 不止第三方系统，用户也参与了授权（重定向页面验证用户身份） 用户可以根据自己的意愿来确认是否授权（比如授予修改密码的权限）  当然不能避免的是引入需要考虑的新问题：\n 如何避免第三方系统身份信息的泄露、被盗用的情况（类似用户帐号密码泄露的情况） 用户直接参与授权验证，交互会更加复杂，给外部的可乘之机就越多 用户的每次授权的时效性（只有一段时间内可用，避免一次授权一直使用，当然也存在特殊场景） 如何避免用户被钓鱼授权（用户在本系统已登录认证过，然后在互联网点击攻击者放置的钓鱼链接以获取其他正规网站的授权）  等等一系列问题，不过现在不需太过深入在意。\n以上是个人学习OAuth2.0授权码模式同时思考的总结，总而言之授权过程的需要考虑：\n 服务使用方是否是可信的 用户信息是否真实 用户是否有意愿来完成授权 互联网的一些安全问题  注：如果已经了解过OAuth2.0的密码模式，或许会注意到该模式并没有验证服务使用方的信息（client_id、client_sercet等），可以说是从传统的用户帐号密码验证演变来的，能提供帐号密码既是可信的（被盗和泄露另说），官方文档上说明(需保密就用授权码模式)：\n If the client type is confidential or the client was issued client\ncredentials (or assigned other authentication requirements), the\nclient MUST authenticate with the authorization server as described\nin Section 3.2.1.\n OAuth2.0授权 首先，和上面思考怎么授权之前一样，OAuth2.0对涉及的角色给出了相关定义。\n resource owner: 资源拥有者，可以理解成常见的用户。\nclient：客户端，请求被授权的应用。可以理解授权服务的使用方。\nresource server：实际提供资源数据的服务器\nauthorization server: 授权服务器\n 在我的理解中，resource server+authorization server可以合称为服务提供方，因为这两者都是由其提供的。只是这里的定义更加详细具体。\n再看OAuth 2.0的抽象运行流程如下图，摘自RFC 6749。\n\n这个图我在我学习OAuth2.0的整个过程中至少看到过五次，然而就算一遍又一遍其中的每一步的意义，始终感觉自己哪里不明白（不知道有人跟我一样不）\n起初我有些困惑这个图为啥和自己印象中的OAuth2.0授权流程不一样，几经思考还是暂时放在一边\n后来才逐渐反应过来这不过是抽象的授权协议流程（印象中的是几个模式具体的流程）\n但紧接着我又疑惑了：为什么抽象的授权协议流程是这样的？与几个模式具体的流程差异这么大？这样的流程有什么好处？\n抽象的授权流程换言之意味着最符合理想效果的流程，所以我反过来思考什么是理想的授权效果？通常的授权方式又有哪里不尽人意？该怎样授权？\n我不想一来就解释（或者说翻译）图中每一步的意义，将自己代入体验生活中的“授权”后再类比图例，更令自己体会深刻（俗称举个栗子）。\n设想一个情景：找人装修 角色： 1. 我们：高大上小区的物业和门卫 2. 张三：他在我们小区刚买了套新房，平时996 3. 李四：老实巴交专门接私活干的装修工 事件：张三请李四帮他装修房子 星期一早上10点，李四拎着他的麻袋来给张三干活。 我一瞧，这么大一个麻袋干嘛的，难不成是人口贩子？不行，得好好盘问盘问：“你谁？来这干嘛得？”。 李四憨厚一笑道：“我是来装修得，张三请我来的，就是1栋2单元3楼4户的业主”。 1234号业主不刚好是物业上面那户程序猿吗，确实是刚买房子还没装，最近常来物业转悠还算挺熟的，我一皱眉，刚想开口再问时，就见他放下麻袋，抽裤兜里掏出一张对半折的整整齐齐的纸条递给我。 “这是张三他给我的委托书，你给看看呢。”他憨笑着摸了摸后脑勺说到。 我接过纸条展开一看眉头一展，这歪七拐八的字确实是那苦逼程序猿张三的真迹，而且这人老实巴交的看也不像假话。“行吧，这委托书我就收下了，你跟我去物业来办个临时工作证，后面就用它进出吧。” 于是李四老老实实跟着我办了证，天天拿着他的临时出入证勤勤恳恳去帮张三装房子去了。 可以代入不同角色去思考，这里从物业门卫的角度考虑，是为了确保小区内的所有居民的安全，不只是特例张三。\n整理下几者之间是如何交互的：\n 张三、李四早就知道李四是没法直接进小区的，所以张三事先给李四整了一张能证实张三身份并说明李四事由的委托书。 李四将委托书交由交由门卫进行验证真实性，并为其办理临时出入证。 李四使用临时身份证开始自己的工作  再看OAuth2.0抽线流程图：\nA：Client找Resource Owner要一个证明，为了完成他委托自己办的事 B：Resource Owner给Client一个证明，这个证明同时记录了委托人、被委托人、委托事项等 C：Client将证明给Authorization server进行验证（这里只是抽象流程，验证真实性的方式不需太过深入） D：Authorization server觉得证明没啥问题，再给了Client整个临时访问的令牌用 E：Client拿着令牌到Resource server确认，并告知他想干嘛 F：Resource server将Client想要的结果数据 这不就像：\n 张三是Resource Owner 李四是Client 物业门卫是Authorization server  或许你会在意Resource server体现在哪，是门卫？房子？E、F步骤怎么体现？\n试想张三老婆天天在家，她知道张三请了装修工，但到底是谁又不清楚，所以李四来的时候还是需要把工作证明给她看看才能进屋（她很信任门卫，毕竟都很有责任心）。\n这样的授权流程很符合理想的效果，但是还需要考虑更加具体现实的问题\nB步骤中Client的证明，是不是他伪造的，就好比看似人畜无害的李四实际是一个诈骗老手，擅长模仿各种字迹呢？或者偷的别人冒名顶替的呢？\n所以这个抽象的授权流程难点无疑在于如何保证B步骤中的\nOAuth 2.0 Endpoints\n解惑   Q:为什么要分授权服务中心和资源服务器？\n  Q:为什么需要有一步Authorization Grant，再换取Access token\n首先，肯定是为了安全！\n授权认证需要client_id、client_sercet，而获取Authorization Grant通常是通过浏览器，直接传输client_sercet是不安全的，所以在此阶段是没有参与认证校验，在应用服务器上还需要用client_sercet、Authorization Grant等信息再一步获取Access token，这是为了保证client_sercet不被泄露！同时也验证了应用程序服务器真实性。\n  Q:为什么简化模式不校验client_sercet直接获取到Access token?\n  stackoverflow\n  Q:简化模式的token获取脚本指的是从授权服务器还是资源服务器?\n  Q:资源服务器如何确认令牌是否真实有效？\n  Q:关于参数state有什么意义\n保持请求设备一致性\n也就是防止CSRF攻击，简单的说就是攻击者用他已有的帐号和他的state向授权服务器申请Authorization Grant后，用其伪造一个链接让用户点击，这样用户以为他授权的是自己帐号，但实际是攻击者专门的帐号，之后用户的所有操作都可被攻击者看见，如果向该帐号推送数据（比如保存文件，密码，转账等等），那就完蛋了！所以说对state进行校验是有必要的，要是传出的和传入的state不等，那直接拒绝就完事了!\n个人觉得 state 如果为固定值的话意义不大，攻击者知道了就形同摆设，最好是动态的！\n可以从以下文章中了解更多\n 关于 OAuth2.0 安全性你应该要知道的一些事 移花接木：针对OAuth2的CSRF攻击 技术干货 | OAuth2.0的安全解析    Q:资源服务器在接受每个请求时，是怎么判断令牌的真实有效性的？\n  参考  OAuth 2.0 的一个简单解释 - 阮一峰 理解OAuth2.0 - 阮一峰 OAuth 2.0 的四种方式 - 阮一峰 OAuth2.0 详解 - 知乎 The OAuth 2.0 Authorization Framework - rfc6749 从“黑掉Github”学Web安全开发 OAuth 2.0 Tutorial 关于 OAuth2.0 安全性你应该要知道的一些事 - chrisyue 移花接木：针对OAuth2的CSRF攻击 技术干货 | OAuth2.0的安全解析  ",
  "wordCount" : "4600",
  "inLanguage": "zh",
  "datePublished": "2021-07-17T16:24:48+08:00",
  "dateModified": "2021-07-17T16:24:48+08:00",
  "author":{
    "@type": "Person",
    "name": "DnF"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://zone.dnfn.tech/2021/07/202107171742448/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DnF's Zone",
    "logo": {
      "@type": "ImageObject",
      "url": "https://zone.dnfn.tech/favicon.svg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zone.dnfn.tech" accesskey="h" title="DnF&#39;s Zone (Alt + H)">DnF&#39;s Zone</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zone.dnfn.tech/search" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://zone.dnfn.tech/categories" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://zone.dnfn.tech/tags" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://zone.dnfn.tech/series" title="系列">
                    <span>系列</span>
                </a>
            </li>
            <li>
                <a href="https://zone.dnfn.tech/archive" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://zone.dnfn.tech/about" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://zone.dnfn.tech">Home</a>&nbsp;»&nbsp;<a href="https://zone.dnfn.tech/post/">Posts</a></div>
    <h1 class="post-title">
      OAuth2
    </h1>
    <div class="post-meta">2021-07-17&nbsp;·&nbsp;DnF
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">目录</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="简介">简介</a></li>
                <li>
                    <a href="#%e4%ba%86%e8%a7%a3%e6%8e%88%e6%9d%83" aria-label="了解授权">了解授权</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%8e%88%e6%9d%83" aria-label="什么是授权">什么是授权</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e6%8e%88%e6%9d%83" aria-label="为什么需要授权">为什么需要授权</a></li>
                <li>
                    <a href="#%e6%80%8e%e4%b9%88%e6%8e%88%e6%9d%83" aria-label="怎么授权">怎么授权</a></li></ul>
                </li>
                <li>
                    <a href="#oauth20%e6%8e%88%e6%9d%83" aria-label="OAuth2.0授权">OAuth2.0授权</a></li>
                <li>
                    <a href="#%e8%a7%a3%e6%83%91" aria-label="解惑">解惑</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="参考">参考</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="简介">简介<a hidden class="anchor" aria-hidden="true" href="#简介">#</a></h2>
<p>记录下授权<code>oauth2</code>的理解，还有自己的疑问等等。</p>
<h2 id="了解授权">了解授权<a hidden class="anchor" aria-hidden="true" href="#了解授权">#</a></h2>
<h3 id="什么是授权">什么是授权<a hidden class="anchor" aria-hidden="true" href="#什么是授权">#</a></h3>
<p>简单来说就是将自己的权限给其他人，让他可以完成相应的工作任务。</p>
<h3 id="为什么需要授权">为什么需要授权<a hidden class="anchor" aria-hidden="true" href="#为什么需要授权">#</a></h3>
<p>互联网作为一个的庞大网络，其中有海量的服务提供方，而我们个人作为这些服务的使用者，通常需要对不同的服务提供相同的信息（比如身份、学历、联系方式等等），而这不就相当于自己把个人信息从一个已有的服务系统拷贝另一个新的服务系统中吗？不想自己做，嫌麻烦了也可以委托其他人来拷贝，但再此之前得找自己信得过帮手让他代替自己（你肯定不希望随便一个陌生人盗用自己得信息），为了不同服务间资源数据的安全共享，这就需要授权！</p>
<h3 id="怎么授权">怎么授权<a hidden class="anchor" aria-hidden="true" href="#怎么授权">#</a></h3>
<p>注：怎么授权换言之就是授权方式，先思考有哪些授权方式，它们可能会遇到的问题和处理方式，至于它们具体实现细节这里不做过多描述。</p>
<p>在了解怎么授权的之前，先思考授权这个过程涉及到了哪些角色（自己的理解，比较片面）：</p>
<ul>
<li>用户：资源数据的所有方</li>
<li>服务提供方：需要共享资源数据给外部的服务</li>
<li>服务使用方：第三方服务、外部服务、接入方、调用方</li>
</ul>
<p>授权行为：用户将自己在服务提供方的权限（部分或全部）给服务使用方，使服务使用方可进行相关权限的操作。</p>
<p>最简单的授权无非是服务提供方将用户的帐号密码给第三方系统（服务使用方），但这是建立在非常信任情况下（应该没有正常人会把自家大门钥匙给一个从未见面的陌生人吧）</p>
<p>共享帐号密码实现确实简单直接，但这真的没有弊端吗？</p>
<p>试想自己作为服务提供方采用这种方案，将会有哪些问题？</p>
<ol>
<li>要是哪天用户的密码换了，又怎么让第三方系统能继续访问资源？（同步帐号密码必然遇到更多问题！）</li>
<li>又或者是哪天第三方其中的一个不再可信，不能再给他权限了，如何保证在不影响用户和其他第三方系统的情况下对其限制？</li>
<li><dfn id=M1></dfn>再说如果给了帐号密码，就相当于用户在操作，又怎么知道用户是否真的出于意愿来进行操作？（难以保证第三方不会滥用帐号密码）</li>
<li>更需要注意的是权限，比如第三方系统已知用户帐号密码，那他是否可以修改用户的密码？</li>
</ol>
<p>以上只是想到的一部分问题，估计要解决这些问题又得牺牲为数不多的头发。</p>
<p>如果站在<strong>被授权方</strong>（服务使用方）的角度，这些问题都不算事，只要你给密码，我能完成工作，那就没问题！<br>
但是站在<strong>授权方</strong>（服务提供方）的角度，那就不得不重视了，不仅是为了用户，也是为了本系统的安全！</p>
<!-- 为什么不直接共享帐号密码 -->
<p>从服务提供方的角度来考虑的话，怎么授权才能避免上面的问题？</p>
<ol>
<li>当然是不与第三方共享密码，或者直接由用户提供帐号密码授权</li>
<li>需要验证第三方服务的身份，不是任何人都可以随便接入授权服务</li>
<li>让用户参与到过程中（提供帐号密码、确认授权范围、确认人为操作）</li>
</ol>
<p>所以授权是最好三方（服务提供方、服务使用方、用户）一起参与才最真实可靠，简单的说就是</p>
<ol>
<li>不止校验用户是否有意愿来完成授权</li>
<li>还要看服务使用方是否是可信的</li>
</ol>
<p>以共享用户帐号密码的方式为例，首先只有完全可信的第三方（服务使用方）才能共享帐号密码，但用户是否真的有意愿使用功能那就不得而知了（<a href="#M1">问题3</a>）。</p>
<p>那么如何做到这些呢？</p>
<p>从OAuth2 授权码模式中可以总结出了这样的答案：</p>
<ol>
<li>服务使用方在服务提供方注册自己的身份信息用于验证是否可信（<code>client_id</code>、<code>client_sercet</code>等）</li>
<li>通过重定向页面让用户确认授权信息（用户信息通过用户登录或者已登录的会话获得，从而关联用户信息和服务使用方）</li>
</ol>
<p>前面说到直接与多个外部系统共享用户帐号密码的方式将面临的问题，正好可以基于以上两点来解决：</p>
<ol>
<li>用户更改密码，并不影响第三方系统（被授权方）在服务提供方已注册的身份信息，两者是独立的</li>
<li>各第三方系统（被授权方）在服务提供方注册的信息也是相互独立的，限制其中一个并不影响其他第三方系统</li>
<li>不止第三方系统，用户也参与了授权（重定向页面验证用户身份）</li>
<li>用户可以根据自己的意愿来确认是否授权（比如授予修改密码的权限）</li>
</ol>
<!-- OAuth2 解决了什么问题？ -->
<p>当然不能避免的是引入需要考虑的新问题：</p>
<ol>
<li>如何避免第三方系统身份信息的泄露、被盗用的情况（类似用户帐号密码泄露的情况）</li>
<li>用户直接参与授权验证，交互会更加复杂，给外部的可乘之机就越多</li>
<li>用户的每次授权的时效性（只有一段时间内可用，避免一次授权一直使用，当然也存在特殊场景）</li>
<li>如何避免用户被钓鱼授权（用户在本系统已登录认证过，然后在互联网点击攻击者放置的钓鱼链接以获取其他正规网站的授权）</li>
</ol>
<p>等等一系列问题，不过现在不需太过深入在意。</p>
<p>以上是个人学习OAuth2.0授权码模式同时思考的总结，总而言之授权过程的需要考虑：</p>
<ol>
<li>服务使用方是否是可信的</li>
<li>用户信息是否真实</li>
<li>用户是否有意愿来完成授权</li>
<li>互联网的一些安全问题</li>
</ol>
<p>注：如果已经了解过OAuth2.0的密码模式，或许会注意到该模式并没有验证服务使用方的信息（<code>client_id</code>、<code>client_sercet</code>等），可以说是从传统的用户帐号密码验证演变来的，能提供帐号密码既是可信的（被盗和泄露另说），<a href="https://datatracker.ietf.org/doc/html/rfc6749" title="The OAuth 2.0 Authorization Framework">官方文档</a>上说明(需保密就用授权码模式)：</p>
<blockquote>
<p>If the client type is confidential or the client was issued client<br>
credentials (or assigned other authentication requirements), the<br>
client MUST authenticate with the authorization server as described<br>
in Section 3.2.1.</p>
</blockquote>
<h2 id="oauth20授权">OAuth2.0授权<a hidden class="anchor" aria-hidden="true" href="#oauth20授权">#</a></h2>
<p>首先，和上面思考怎么授权之前一样，OAuth2.0对涉及的角色给出了相关<a href="https://datatracker.ietf.org/doc/html/rfc6749" title="The OAuth 2.0 Authorization Framework">定义</a>。</p>
<blockquote>
<p>resource owner: 资源拥有者，可以理解成常见的用户。<br>
client：客户端，请求被授权的应用。可以理解授权服务的使用方。<br>
resource server：实际提供资源数据的服务器<br>
authorization server: 授权服务器</p>
</blockquote>
<p>在我的理解中，<code>resource server</code>+<code>authorization server</code>可以合称为服务提供方，因为这两者都是由其提供的。只是这里的定义更加详细具体。</p>
<p>再看OAuth 2.0的抽象运行流程如下图，摘自<a href="https://datatracker.ietf.org/doc/html/rfc6749" title="The OAuth 2.0 Authorization Framework">RFC 6749</a>。</p>
<p><a href="https://oss.dnfn.tech:1024/bedroom/2021/8/3/20210803161505.png#center" title="Figure 1: Abstract Protocol Flow"><img loading="lazy" src="https://oss.dnfn.tech:1024/bedroom/2021/8/3/20210803161505.png#center" alt="Figure 1: Abstract Protocol Flow"  title="Figure 1: Abstract Protocol Flow"  />
</a></p>
<p>这个图我在我学习OAuth2.0的整个过程中至少看到过五次，然而就算一遍又一遍其中的每一步的意义，始终感觉自己哪里不明白（不知道有人跟我一样不）</p>
<p>起初我有些困惑这个图为啥和自己印象中的OAuth2.0授权流程不一样，几经思考还是暂时放在一边</p>
<p>后来才逐渐反应过来这不过是抽象的授权协议流程（印象中的是几个模式具体的流程）</p>
<p>但紧接着我又疑惑了：为什么抽象的授权协议流程是这样的？与几个模式具体的流程差异这么大？这样的流程有什么好处？</p>
<p>抽象的授权流程换言之意味着最符合理想效果的流程，所以我反过来思考什么是理想的授权效果？通常的授权方式又有哪里不尽人意？该怎样授权？</p>
<p>我不想一来就解释（或者说翻译）图中每一步的意义，将自己代入体验生活中的“授权”后再类比图例，更令自己体会深刻（俗称举个栗子）。</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">设想一个情景：找人装修

角色：

<span class="k">1.</span> 我们：高大上小区的物业和门卫
<span class="k">2.</span> 张三：他在我们小区刚买了套新房，平时996
<span class="k">3.</span> 李四：老实巴交专门接私活干的装修工

事件：张三请李四帮他装修房子

星期一早上10点，李四拎着他的麻袋来给张三干活。

我一瞧，这么大一个麻袋干嘛的，难不成是人口贩子？不行，得好好盘问盘问：“你谁？来这干嘛得？”。
李四憨厚一笑道：“我是来装修得，张三请我来的，就是1栋2单元3楼4户的业主”。

1234号业主不刚好是物业上面那户程序猿吗，确实是刚买房子还没装，最近常来物业转悠还算挺熟的，我一皱眉，刚想开口再问时，就见他放下麻袋，抽裤兜里掏出一张对半折的整整齐齐的纸条递给我。

“这是张三他给我的委托书，你给看看呢。”他憨笑着摸了摸后脑勺说到。

我接过纸条展开一看眉头一展，这歪七拐八的字确实是那苦逼程序猿张三的真迹，而且这人老实巴交的看也不像假话。“行吧，这委托书我就收下了，你跟我去物业来办个临时工作证，后面就用它进出吧。”

于是李四老老实实跟着我办了证，天天拿着他的临时出入证勤勤恳恳去帮张三装房子去了。
</code></pre></div><p>可以代入不同角色去思考，这里从物业门卫的角度考虑，是为了确保小区内的所有居民的安全，不只是特例张三。</p>
<p>整理下几者之间是如何交互的：</p>
<ol>
<li>张三、李四早就知道李四是没法直接进小区的，所以张三事先给李四整了一张能证实张三身份并说明李四事由的委托书。</li>
<li>李四将委托书交由交由门卫进行验证真实性，并为其办理临时出入证。</li>
<li>李四使用临时身份证开始自己的工作</li>
</ol>
<p>再看OAuth2.0抽线流程图：</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">A：Client找Resource Owner要一个证明，为了完成他委托自己办的事
B：Resource Owner给Client一个证明，这个证明同时记录了委托人、被委托人、委托事项等
C：Client将证明给Authorization server进行验证（这里只是抽象流程，验证真实性的方式不需太过深入）
D：Authorization server觉得证明没啥问题，再给了Client整个临时访问的令牌用
E：Client拿着令牌到Resource server确认，并告知他想干嘛
F：Resource server将Client想要的结果数据
</code></pre></div><p>这不就像：</p>
<ol>
<li>张三是Resource Owner</li>
<li>李四是Client</li>
<li>物业门卫是Authorization server</li>
</ol>
<p>或许你会在意Resource server体现在哪，是门卫？房子？E、F步骤怎么体现？</p>
<p>试想张三老婆天天在家，她知道张三请了装修工，但到底是谁又不清楚，所以李四来的时候还是需要把工作证明给她看看才能进屋（她很信任门卫，毕竟都很有责任心）。</p>
<p>这样的授权流程很符合理想的效果，但是还需要考虑更加具体现实的问题</p>
<p>B步骤中Client的证明，是不是他伪造的，就好比看似人畜无害的李四实际是一个诈骗老手，擅长模仿各种字迹呢？或者偷的别人冒名顶替的呢？</p>
<p>所以这个抽象的授权流程难点无疑在于如何保证B步骤中的</p>
<!--
我定眼一看：好家伙，大腿粗一样的肱二头肌，NB！不过这车粉色的喷漆更SAO啊！傻眼归傻眼，正事还得办。
我站起来问到：“停下！你谁啊？来这干嘛？”。

“我是搞装修的，1栋2单元3楼4号房的老哥让我帮他装房子。”老王随即一脚刹车停在我旁边说到，就他这架势谁信啊，我刚想开口，只见他从屁股兜里掏出一张皱巴巴的纸给我“这是他写的委托书，说是让门卫看下，他认得出来”，上面写着：【委托书：我张三委托老王帮忙装修....】。

这委托书写得还像那么点样子，张三不是我新认识楼下那户苦逼的程序猿吗，这字确实是他的。“行吧，你进去吧，这委托书我就收着了。”
-->
<!--
1. 用户如何告诉授权服务器对第三方应用程序授权
2. 授权服务器如果将访问令牌给第三方应用程序
-->
<p><a href="http://tutorials.jenkov.com/oauth2/endpoints.html" title="OAuth 2.0 Endpoints">OAuth 2.0 Endpoints</a></p>
<h2 id="解惑">解惑<a hidden class="anchor" aria-hidden="true" href="#解惑">#</a></h2>
<ul>
<li>
<p>Q:为什么要分授权服务中心和资源服务器？</p>
</li>
<li>
<p>Q:为什么需要有一步<code>Authorization Grant</code>，再换取<code>Access token</code></p>
<p>首先，肯定是为了安全！<br>
授权认证需要<code>client_id</code>、<code>client_sercet</code>，而获取<code>Authorization Grant</code>通常是通过浏览器，直接传输<code>client_sercet</code>是不安全的，所以在此阶段是没有参与认证校验，在应用服务器上还需要用<code>client_sercet</code>、<code>Authorization Grant</code>等信息再一步获取<code>Access token</code>，这是为了保证<code>client_sercet</code>不被泄露！同时也验证了应用程序服务器真实性。</p>
</li>
<li>
<p>Q:为什么简化模式不校验<code>client_sercet</code>直接获取到<code>Access token</code>?</p>
</li>
</ul>
<!--
  与授权码模式的安全性
  适用的场景
-->
<p><a href="http://stackoverflow.com/questions/13387698/why-is-there-an-authorization-code-flow-in-oauth2-when-implicit-flow-works-s" title="stackoverflow">stackoverflow</a></p>
<ul>
<li>
<p>Q:简化模式的token获取脚本指的是从授权服务器还是资源服务器?</p>
</li>
<li>
<p>Q:资源服务器如何确认令牌是否真实有效？</p>
</li>
<li>
<p>Q:关于参数<code>state</code>有什么意义</p>
<p>保持请求设备一致性</p>
<p>也就是防止<code>CSRF</code>攻击，简单的说就是攻击者用他已有的帐号和他的<code>state</code>向授权服务器申请<code>Authorization Grant</code>后，用其伪造一个链接让用户点击，这样用户以为他授权的是自己帐号，但实际是攻击者专门的帐号，之后用户的所有操作都可被攻击者看见，如果向该帐号推送数据（比如保存文件，密码，转账等等），那就完蛋了！所以说对<code>state</code>进行校验是有必要的，要是传出的和传入的<code>state</code>不等，那直接拒绝就完事了!</p>
<p>个人觉得 <code>state</code> 如果为固定值的话意义不大，攻击者知道了就形同摆设，最好是动态的！</p>
<p>可以从以下文章中了解更多</p>
<ol>
<li><a href="https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html" title="关于 OAuth2.0 安全性你应该要知道的一些事">关于 OAuth2.0 安全性你应该要知道的一些事</a></li>
<li><a href="https://www.jianshu.com/p/c7c8f51713b6" title="移花接木：针对OAuth2的CSRF攻击">移花接木：针对OAuth2的CSRF攻击</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/214107728" title="技术干货 | OAuth2.0的安全解析">技术干货 | OAuth2.0的安全解析</a></li>
</ol>
</li>
<li>
<p>Q:资源服务器在接受每个请求时，是怎么判断令牌的真实有效性的？</p>
</li>
</ul>
<h2 id="参考">参考<a hidden class="anchor" aria-hidden="true" href="#参考">#</a></h2>
<ol>
<li><a href="https://www.ruanyifeng.com/blog/2019/04/oauth_design.html" title="OAuth 2.0 的一个简单解释">OAuth 2.0 的一个简单解释</a> - 阮一峰</li>
<li><a href="https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" title="理解OAuth2.0">理解OAuth2.0</a> - 阮一峰</li>
<li><a href="https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html" title="OAuth 2.0 的四种方式">OAuth 2.0 的四种方式</a> - 阮一峰</li>
<li><a href="https://zhuanlan.zhihu.com/p/89020647" title="OAuth2.0 详解">OAuth2.0 详解</a> - 知乎</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6749" title="The OAuth 2.0 Authorization Framework">The OAuth 2.0 Authorization Framework</a> - rfc6749</li>
<li><a href="https://coolshell.cn/articles/11021.html" title="从“黑掉Github”学Web安全开发">从“黑掉Github”学Web安全开发</a></li>
<li><a href="http://tutorials.jenkov.com/oauth2/index.html" title="OAuth 2.0 Tutorial">OAuth 2.0 Tutorial</a></li>
<li><a href="https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html" title="关于 OAuth2.0 安全性你应该要知道的一些事">关于 OAuth2.0 安全性你应该要知道的一些事</a> - chrisyue</li>
<li><a href="https://www.jianshu.com/p/c7c8f51713b6" title="移花接木：针对OAuth2的CSRF攻击">移花接木：针对OAuth2的CSRF攻击</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/214107728" title="技术干货 | OAuth2.0的安全解析">技术干货 | OAuth2.0的安全解析</a></li>
</ol>
<!-- footer -->
<!-- pic -->
<!-- links -->

  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://zone.dnfn.tech/tags/web/">web</a></li>
      <li><a href="https://zone.dnfn.tech/tags/auth/">auth</a></li>
      <li><a href="https://zone.dnfn.tech/tags/oauth2/">oauth2</a></li>
    </ul>
<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on twitter"
        href="https://twitter.com/intent/tweet/?text=OAuth2&amp;url=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f&amp;hashtags=web%2cauth%2coauth2">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f&amp;title=OAuth2&amp;summary=OAuth2&amp;source=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f&title=OAuth2">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on whatsapp"
        href="https://api.whatsapp.com/send?text=OAuth2%20-%20https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OAuth2 on telegram"
        href="https://telegram.me/share/url?text=OAuth2&amp;url=https%3a%2f%2fzone.dnfn.tech%2f2021%2f07%2f202107171742448%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://zone.dnfn.tech">DnF&#39;s Zone</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
